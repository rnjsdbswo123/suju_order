{% extends 'base.html' %}

{% block content %}
<div class="container mt-4" style="max-width: 800px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold">📂 데이터 관리</h3>
        <a href="/api/production/status/" class="btn btn-outline-dark btn-sm">🏠 메인으로</a>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if '성공' in message.tags %}alert-success{% else %}alert-danger{% endif %} shadow-sm">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="card shadow-sm mb-4">
        <div class="card-header fw-bold">
            ✍️ 개별 등록
        </div>
        <div class="card-body text-center">
            <p class="text-muted">엑셀 파일 없이 거래처나 품목을 1개씩 등록합니다.</p>
            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <a href="{% url 'customer-create' %}" class="btn btn-primary">➕ 신규 거래처 등록</a>
                <a href="{% url 'product-create' %}" class="btn btn-success">📦 신규 품목 등록</a>
            </div>
        </div>
    </div>

    <div class="accordion" id="excelUploadAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    <h5 class="fw-bold m-0">📤 엑셀로 일괄 업로드</h5>
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#excelUploadAccordion">
                <div class="accordion-body">

                    <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
                        <div class="fs-4 me-3">⚠️</div>
                        <div>
                            <strong>주의사항:</strong> 모든 엑셀 파일의 <strong>첫 번째 줄(1행)은 제목으로 간주하여 건너뜁니다.</strong><br>
                            실제 데이터는 <strong>2번째 줄</strong>부터 입력해 주세요.
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-12">
                            <div class="card shadow-sm border-primary border-opacity-25">
                                <div class="card-header bg-primary text-white fw-bold d-flex justify-content-between">
                                    <span>1. 거래처 등록 (Customer)</span>
                                    <small>Step 1</small>
                                </div>
                                <div class="card-body">
                                    <h6 class="fw-bold text-primary mb-2">📊 엑셀 작성 양식</h6>
                                    <table class="table table-bordered table-sm text-center small mb-3">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 40%;">A열 (필수)</th>
                                                <th style="width: 40%;">B열 (선택)</th>
                                                <th style="width: 20%;">C열 (선택)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="fw-bold">
                                                <td>거래처명</td>
                                                <td>사업자번호</td>
                                                <td>활성여부</td>
                                            </tr>
                                            <tr class="text-muted">
                                                <td>(예) 김밥천국 본점</td>
                                                <td>123-45-67890</td>
                                                <td>FALSE</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="alert alert-info small py-2 mb-3">
                                        ※ <strong>활성여부(C열)</strong>: <code>FALSE</code> 입력 시 '비활성' 처리됩니다. <br>
                                        &nbsp;&nbsp;&nbsp;셀을 비워두거나 다른 값을 입력하면 '활성' 상태로 생성 또는 업데이트됩니다.
                                    </div>

                                    <form method="post" enctype="multipart/form-data" class="input-group">
                                        {% csrf_token %}
                                        <input type="file" name="customer_file" class="form-control" required accept=".xlsx, .xls">
                                        <button class="btn btn-primary" type="submit">거래처 업로드</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="card shadow-sm border-success border-opacity-25">
                                <div class="card-header bg-success text-white fw-bold d-flex justify-content-between">
                                    <span>2. 품목 등록 (Product)</span>
                                    <small>Step 2</small>
                                </div>
                                <div class="card-body">
                                    <h6 class="fw-bold text-success mb-2">📊 엑셀 작성 양식</h6>
                                    <table class="table table-bordered table-sm text-center small mb-3">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 30%;">A열 (선택)</th>
                                                <th style="width: 30%;">B열 (필수/고유)</th>
                                                <th style="width: 20%;">C열 (숫자)</th>
                                                <th style="width: 20%;">D열 (선택)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="fw-bold">
                                                <td>품목명</td>
                                                <td>SKU (품목코드)</td>
                                                <td>단가</td>
                                                <td>생산동</td>
                                            </tr>
                                            <tr class="text-muted">
                                                <td>(예) 계란 30구</td>
                                                <td>EG-30-001</td>
                                                <td>5000</td>
                                                <td>A동</td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <form method="post" enctype="multipart/form-data" class="input-group">
                                        {% csrf_token %}
                                        <input type="file" name="product_file" class="form-control" required accept=".xlsx, .xls">
                                        <button class="btn btn-success" type="submit">품목 업로드</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="card shadow-sm border-dark border-opacity-25">
                                <div class="card-header bg-dark text-white fw-bold d-flex justify-content-between">
                                    <span>3. 거래처-품목 연결 (Mapping)</span>
                                    <small>Step 3</small>
                                </div>
                                <div class="card-body">
                                    <h6 class="fw-bold text-dark mb-2">📊 엑셀 작성 양식</h6>
                                    <div class="alert alert-secondary small py-2 mb-2">
                                        ※ <strong>Step 1, 2</strong>에 등록된 거래처명과 SKU가 정확히 일치해야 합니다.
                                    </div>
                                    <table class="table table-bordered table-sm text-center small mb-3">
                                        <thead class="table-light">
                                            <tr>
                                                <th style="width: 50%;">A열 (정확한 이름)</th>
                                                <th style="width: 50%;">B열 (정확한 코드)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="fw-bold">
                                                <td>거래처명</td>
                                                <td>품목코드 (SKU)</td>
                                            </tr>
                                            <tr class="text-muted">
                                                <td>(예) 김밥천국 본점</td>
                                                <td>EG-30-001</td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <form method="post" enctype="multipart/form-data" class="input-group">
                                        {% csrf_token %}
                                        <input type="file" name="mapping_file" class="form-control" required accept=".xlsx, .xls">
                                        <button class="btn btn-dark" type="submit">매핑 업로드</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="card shadow-sm border-info border-opacity-25">
                                <div class="card-header bg-info text-white fw-bold d-flex justify-content-between">
                                    <span>4. 부자재 등록 (Raw Material)</span>
                                    <small>Step 4</small>
                                </div>
                                <div class="card-body">
                                    <h6 class="fw-bold text-info mb-2">📊 엑셀 작성 양식</h6>
                                    <table class="table table-bordered table-sm text-center small mb-3">
                                        <thead class="table-light">
                                            <tr>
                                                <th>A열 (필수)</th>
                                                <th>B열 (필수/고유)</th>
                                                <th>C열 (선택)</th>
                                                <th>D열 (선택/숫자)</th>
                                                <th>E열 (선택)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="fw-bold">
                                                <td>부자재명</td>
                                                <td>부자재코드</td>
                                                <td>바코드</td>
                                                <td>단가</td>
                                                <td>활성여부</td>
                                            </tr>
                                            <tr class="text-muted">
                                                <td>(예) 신선계란 30구</td>
                                                <td>RM-EG-30</td>
                                                <td>8801234567890</td>
                                                <td>4500</td>
                                                <td>TRUE</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="alert alert-info small py-2 mb-3">
                                        ※ <strong>활성여부(E열)</strong>: <code>FALSE</code> 입력 시 '비활성' 처리됩니다. <br>
                                        &nbsp;&nbsp;&nbsp;셀을 비워두거나 다른 값을 입력하면 '활성' 상태로 생성 또는 업데이트됩니다.
                                    </div>

                                    <form method="post" enctype="multipart/form-data" class="input-group">
                                        {% csrf_token %}
                                        <input type="file" name="rawmaterial_file" class="form-control" required accept=".xlsx, .xls">
                                        <button class="btn btn-info" type="submit">부자재 업로드</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="text-center mt-5 mb-5 text-muted small">
        &copy; 2025 Order Management System
    </div>
</div>
{% endblock %}