{% extends 'base.html' %}

{% block title %}{% if is_edit_mode %}ë¶€ìì¬ ìˆ˜ì •{% else %}ì‹ ê·œ ë¶€ìì¬ ë“±ë¡{% endif %}{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 600px;">
    <h3 class="fw-bold mb-4">{% if is_edit_mode %}âœï¸ ë¶€ìì¬ ìˆ˜ì •{% else %}ğŸ“¦ ì‹ ê·œ ë¶€ìì¬ ë“±ë¡{% endif %}</h3>

    <div class="card shadow-sm">
        <div class="card-body p-4">
            <form method="post" enctype="multipart/form-data" id="main-form">
                {% csrf_token %}

                {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %}">{{ message }}</div>
                    {% endfor %}
                {% endif %}

                <div class="mb-3">
                    <label for="id_name" class="form-label fw-bold">ë¶€ìì¬ëª…</label>
                    <input type="text" name="name" class="form-control" required id="id_name" value="{{ form.instance.name|default:'' }}">
                </div>

                <div class="mb-3">
                    <label for="id_sku" class="form-label fw-bold">ë¶€ìì¬ì½”ë“œ (SKU)</label>
                    <input type="text" name="sku" class="form-control" required id="id_sku" value="{{ form.instance.sku|default:'' }}">
                    <div class="form-text">ë¶€ìì¬ë¥¼ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ ì½”ë“œì…ë‹ˆë‹¤. ì¤‘ë³µë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>

                <div class="mb-3">
                    <label for="id_barcode" class="form-label fw-bold">ë°”ì½”ë“œ</label>
                    <input type="text" name="barcode" class="form-control" id="id_barcode" value="{{ form.instance.barcode|default:'' }}">
                </div>

                <div class="mb-3">
                    <label for="id_unit_price" class="form-label fw-bold">ë‹¨ê°€</label>
                    <div class="input-group">
                        <input type="number" name="unit_price" value="{{ form.instance.unit_price|default:0 }}" class="form-control" required id="id_unit_price">
                        <span class="input-group-text">ì›</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="id_image" class="form-label fw-bold">ì´ë¯¸ì§€</label>
                    {% if form.instance.image %}
                        <div class="mb-2">
                            í˜„ì¬ ì´ë¯¸ì§€: 
                            <img src="{{ form.instance.image.url }}" alt="{{ form.instance.name }}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; vertical-align: middle;" onclick="showImageModal('{{ form.instance.image.url }}')">
                            <a href="{{ form.instance.image.url }}" target="_blank">{{ form.instance.image.name }}</a>
                        </div>
                    {% endif %}
                    <input type="file" name="image" class="form-control" id="id_image">
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="is_active" id="id_is_active" {% if form.instance.is_active %}checked{% endif %}>
                    <label class="form-check-label" for="id_is_active">
                        í™œì„± ìƒíƒœ
                    </label>
                </div>
            </form>

            <div class="mt-4">
                <div class="d-flex gap-2">
                    <button type="submit" form="main-form" class="btn btn-primary fw-bold flex-grow-1 py-2">{% if is_edit_mode %}ìˆ˜ì •í•˜ê¸°{% else %}ë“±ë¡í•˜ê¸°{% endif %}</button>
                    
                    {% if is_edit_mode %}
                    <form action="{% url 'rawmaterial-delete' form.instance.pk %}" method="post" onsubmit="return confirm('ì •ë§ë¡œ ì´ ë¶€ìì¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger fw-bold flex-grow-1 py-2">ì‚­ì œ</button>
                    </form>
                    {% endif %}
                    
                    <a href="{% if is_edit_mode %}{% url 'rawmaterial-list' %}{% else %}{% url 'data-upload' %}{% endif %}" class="btn btn-outline-secondary">ì·¨ì†Œ</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
